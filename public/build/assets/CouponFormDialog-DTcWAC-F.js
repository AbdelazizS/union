var k=n=>{throw TypeError(n)};var T=(n,t,r)=>t.has(n)||k("Cannot "+r);var l=(n,t,r)=>(T(n,t,"read from private field"),r?r.call(n):t.get(n)),S=(n,t,r)=>t.has(n)?k("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,r),w=(n,t,r,a)=>(T(n,t,"write to private field"),a?a.call(n,r):t.set(n,r),r),P=(n,t,r)=>(T(n,t,"access private method"),r);import{r as g,j as e,a as R}from"./app-D5zgOKAD.js";import{u as ee,F as te,a as m,b as h,c as p,d as x,f as C,e as j}from"./form-B0NGfjOj.js";import{s as se}from"./zod-CTB78kiI.js";import{o as re,a as V,b as ne,d as q,c as M,e as ie,s as ae,n as A}from"./index-DWbN24nP.js";import{t as Q}from"./index-CDOhrpKr.js";import{D as oe,b as le,c as ue,d as ce,e as de,f as me}from"./dialog-sDPXERkU.js";import{S as he,a as pe,b as xe,c as be,d as I}from"./select-DgOef9zO.js";import{I as N}from"./input-D5FKwQjB.js";import{B as D,c as K}from"./index-C8-8ZKTM.js";import{S as fe}from"./switch-CQMIwMOV.js";import{P as L,a as B,b as H,C as $}from"./popover-CYbGzW0S.js";import{C as z}from"./calendar-CP_I-VWs.js";import{f as J}from"./format-SmSpYad1.js";import"./label-BHpa9F8K.js";import"./index-BBAzO_4d.js";import"./index-B6dbISNz.js";import"./index-BSVezLny.js";import"./Combination-Cmb1a147.js";import"./tslib.es6-CmEaCU22.js";import"./index-Cuq-Mmvq.js";import"./x-DkObbUL-.js";import"./createLucideIcon-AWgR876W.js";import"./index-Crc4BVh8.js";import"./index-BB6OtDRK.js";import"./index-DNxp1Wi1.js";import"./index-BKYgjeKX.js";import"./index-CrEWOBzh.js";import"./chevron-down-CztE_ilu.js";import"./check-BhB20Pym.js";import"./chevron-right-DKEmXFr0.js";import"./chevron-left-AmoEll6X.js";var je=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}};function ge(){}function G(n){return JSON.stringify(n,(t,r)=>ye(r)?Object.keys(r).sort().reduce((a,i)=>(a[i]=r[i],a),{}):r)}function ve(n,t){if(!t||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(n[r]!==t[r])return!1;return!0}function ye(n){if(!W(n))return!1;const t=n.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!W(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function W(n){return Object.prototype.toString.call(n)==="[object Object]"}function Ce(n,t){return typeof n=="function"?n(...t):!!n}var _e=n=>setTimeout(n,0);function Se(){let n=[],t=0,r=s=>{s()},a=s=>{s()},i=_e;const c=s=>{t?n.push(s):i(()=>{r(s)})},d=()=>{const s=n;n=[],s.length&&i(()=>{a(()=>{s.forEach(o=>{r(o)})})})};return{batch:s=>{let o;t++;try{o=s()}finally{t--,t||d()}return o},batchCalls:s=>(...o)=>{c(()=>{s(...o)})},schedule:c,setNotifyFunction:s=>{r=s},setBatchNotifyFunction:s=>{a=s},setScheduler:s=>{i=s}}}var Y=Se();function we(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var v,y,u,b,f,E,U,X,Pe=(X=class extends je{constructor(t,r){super();S(this,f);S(this,v);S(this,y);S(this,u);S(this,b);w(this,v,t),this.setOptions(r),this.bindMethods(),P(this,f,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var a;const r=this.options;this.options=l(this,v).defaultMutationOptions(t),ve(this.options,r)||l(this,v).getMutationCache().notify({type:"observerOptionsUpdated",mutation:l(this,u),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&G(r.mutationKey)!==G(this.options.mutationKey)?this.reset():((a=l(this,u))==null?void 0:a.state.status)==="pending"&&l(this,u).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=l(this,u))==null||t.removeObserver(this)}onMutationUpdate(t){P(this,f,E).call(this),P(this,f,U).call(this,t)}getCurrentResult(){return l(this,y)}reset(){var t;(t=l(this,u))==null||t.removeObserver(this),w(this,u,void 0),P(this,f,E).call(this),P(this,f,U).call(this)}mutate(t,r){var a;return w(this,b,r),(a=l(this,u))==null||a.removeObserver(this),w(this,u,l(this,v).getMutationCache().build(l(this,v),this.options)),l(this,u).addObserver(this),l(this,u).execute(t)}},v=new WeakMap,y=new WeakMap,u=new WeakMap,b=new WeakMap,f=new WeakSet,E=function(){var r;const t=((r=l(this,u))==null?void 0:r.state)??we();w(this,y,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},U=function(t){Y.batch(()=>{var r,a,i,c,d,s,o,F;if(l(this,b)&&this.hasListeners()){const _=l(this,y).variables,O=l(this,y).context;(t==null?void 0:t.type)==="success"?((a=(r=l(this,b)).onSuccess)==null||a.call(r,t.data,_,O),(c=(i=l(this,b)).onSettled)==null||c.call(i,t.data,null,_,O)):(t==null?void 0:t.type)==="error"&&((s=(d=l(this,b)).onError)==null||s.call(d,t.error,_,O),(F=(o=l(this,b)).onSettled)==null||F.call(o,void 0,t.error,_,O))}this.listeners.forEach(_=>{_(l(this,y))})})},X),Fe=g.createContext(void 0),Z=n=>{const t=g.useContext(Fe);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t};function Ne(n,t){const r=Z(),[a]=g.useState(()=>new Pe(r,n));g.useEffect(()=>{a.setOptions(n)},[a,n]);const i=g.useSyncExternalStore(g.useCallback(d=>a.subscribe(Y.batchCalls(d)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),c=g.useCallback((d,s)=>{a.mutate(d,s).catch(ge)},[a]);if(i.error&&Ce(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:c,mutateAsync:i.mutate}}const Oe=re({code:ae().min(3,"Code must be at least 3 characters").max(50,"Code must be less than 50 characters"),type:ie(["percentage","fixed"]),discount_value:M.number().min(0,"Discount value must be greater than 0").max(100,"Percentage discount cannot exceed 100%"),min_order_amount:M.number().min(0,"Minimum order amount must be greater than 0").nullable(),max_discount_amount:M.number().min(0,"Maximum discount amount must be greater than 0").nullable(),usage_limit:M.number().int("Usage limit must be a whole number").min(1,"Usage limit must be at least 1").nullable(),valid_from:q().nullable(),valid_until:q().nullable(),is_active:ne().default(!0),applicable_categories:V(A()).nullable(),applicable_services:V(A()).nullable()});function lt({open:n,onOpenChange:t,coupon:r}){const a=Z(),i=ee({resolver:se(Oe),defaultValues:{code:"",type:"percentage",discount_value:0,min_order_amount:null,max_discount_amount:null,usage_limit:null,valid_from:null,valid_until:null,is_active:!0,applicable_categories:null,applicable_services:null}});g.useEffect(()=>{r?i.reset({...r,valid_from:r.valid_from?new Date(r.valid_from):null,valid_until:r.valid_until?new Date(r.valid_until):null}):i.reset({code:"",type:"percentage",discount_value:0,min_order_amount:null,max_discount_amount:null,usage_limit:null,valid_from:null,valid_until:null,is_active:!0,applicable_categories:null,applicable_services:null})},[r]);const c=Ne({mutationFn:async s=>{r?await R.put(`/admin/coupons/${r.id}`,s):await R.post("/admin/coupons",s)},onSuccess:()=>{a.invalidateQueries(["coupons"]),Q.success(`Coupon ${r?"updated":"created"} successfully`),t(!1)},onError:s=>{var o,F;Q.error(((F=(o=s.response)==null?void 0:o.data)==null?void 0:F.message)||"Something went wrong")}});function d(s){c.mutate(s)}return e.jsx(oe,{open:n,onOpenChange:t,children:e.jsxs(le,{className:"sm:max-w-lg",children:[e.jsxs(ue,{children:[e.jsx(ce,{children:r?"Edit Coupon":"Create Coupon"}),e.jsx(de,{children:r?"Edit the details of the existing coupon":"Create a new discount coupon"})]}),e.jsx(te,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(d),className:"space-y-4",children:[e.jsx(m,{control:i.control,name:"code",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Code"}),e.jsx(x,{children:e.jsx(N,{placeholder:"SUMMER2024",...s})}),e.jsx(C,{children:"The code customers will enter to apply the discount"}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"type",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Type"}),e.jsxs(he,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(x,{children:e.jsx(pe,{children:e.jsx(xe,{placeholder:"Select discount type"})})}),e.jsxs(be,{children:[e.jsx(I,{value:"percentage",children:"Percentage"}),e.jsx(I,{value:"fixed",children:"Fixed Amount"})]})]}),e.jsx(C,{children:"Choose between percentage or fixed amount discount"}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"discount_value",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Discount Value"}),e.jsx(x,{children:e.jsx(N,{type:"number",placeholder:i.watch("type")==="percentage"?"10":"50",...s})}),e.jsx(C,{children:i.watch("type")==="percentage"?"Percentage discount (0-100)":"Fixed amount discount"}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"min_order_amount",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Minimum Order Amount"}),e.jsx(x,{children:e.jsx(N,{type:"number",placeholder:"100",...s,onChange:o=>s.onChange(o.target.value?Number(o.target.value):null)})}),e.jsx(C,{children:"Minimum order amount required to use this coupon"}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"max_discount_amount",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Maximum Discount Amount"}),e.jsx(x,{children:e.jsx(N,{type:"number",placeholder:"50",...s,onChange:o=>s.onChange(o.target.value?Number(o.target.value):null)})}),e.jsx(C,{children:"Maximum amount that can be discounted"}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"usage_limit",render:({field:s})=>e.jsxs(h,{children:[e.jsx(p,{children:"Usage Limit"}),e.jsx(x,{children:e.jsx(N,{type:"number",placeholder:"100",...s,onChange:o=>s.onChange(o.target.value?Number(o.target.value):null)})}),e.jsx(C,{children:"Maximum number of times this coupon can be used"}),e.jsx(j,{})]})}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(m,{control:i.control,name:"valid_from",render:({field:s})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(p,{children:"Valid From"}),e.jsxs(L,{children:[e.jsx(B,{asChild:!0,children:e.jsx(x,{children:e.jsxs(D,{variant:"outline",className:K("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?J(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(H,{className:"w-auto p-0",align:"start",children:e.jsx($,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:o=>o<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),e.jsx(j,{})]})}),e.jsx(m,{control:i.control,name:"valid_until",render:({field:s})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(p,{children:"Valid Until"}),e.jsxs(L,{children:[e.jsx(B,{asChild:!0,children:e.jsx(x,{children:e.jsxs(D,{variant:"outline",className:K("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?J(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(H,{className:"w-auto p-0",align:"start",children:e.jsx($,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:o=>o<new Date(i.watch("valid_from")||new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),e.jsx(j,{})]})})]}),e.jsx(m,{control:i.control,name:"is_active",render:({field:s})=>e.jsxs(h,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{className:"text-base",children:"Active"}),e.jsx(C,{children:"Enable or disable this coupon"})]}),e.jsx(x,{children:e.jsx(fe,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsxs(me,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(D,{type:"submit",disabled:c.isPending,children:c.isPending?e.jsx("span",{children:"Saving..."}):r?"Update Coupon":"Create Coupon"})]})]})})]})})}export{lt as default};
