import{r as o,j as e,$ as Z,m as l}from"./app-D5zgOKAD.js";import{t as a}from"./index-CDOhrpKr.js";import{u as ee,D as te,g as se,a as oe,b as ae,c as ne}from"./data-table-xuiH6-jF.js";import{u as T}from"./form-B0NGfjOj.js";import{s as O}from"./zod-CTB78kiI.js";import{o as ie,a as P,b as re,d as R,c as p,e as le,s as ce,n as E}from"./index-DWbN24nP.js";import{L as me}from"./AdminLayout-BQ9sENZH.js";import{B as _}from"./index-C8-8ZKTM.js";import{D as h,a as de,b as g,c as x,d as f,e as j}from"./dialog-sDPXERkU.js";import{CouponForm as M}from"./CouponForm-CHRBxmoP.js";import{columns as $}from"./columns-Zl-vjCBT.js";import{P as ue}from"./plus-DHVrmD6B.js";import{f as A}from"./format-SmSpYad1.js";import"./index-BBAzO_4d.js";import"./table-C18x9kzE.js";import"./input-D5FKwQjB.js";import"./select-DgOef9zO.js";import"./index-BSVezLny.js";import"./index-Crc4BVh8.js";import"./Combination-Cmb1a147.js";import"./tslib.es6-CmEaCU22.js";import"./index-BB6OtDRK.js";import"./index-DNxp1Wi1.js";import"./index-BKYgjeKX.js";import"./index-CrEWOBzh.js";import"./chevron-down-CztE_ilu.js";import"./createLucideIcon-AWgR876W.js";import"./check-BhB20Pym.js";import"./label-BHpa9F8K.js";import"./separator-ZBq7OQqG.js";import"./sheet-CpllKNoK.js";import"./index-B6dbISNz.js";import"./index-Cuq-Mmvq.js";import"./x-DkObbUL-.js";import"./layers-ai9ES5Yn.js";import"./calendar-CP_I-VWs.js";import"./circle-help-DHWhEvao.js";import"./file-text-CyaKJaEx.js";import"./dropdown-menu-CixTnASt.js";import"./chevron-right-DKEmXFr0.js";import"./user-Ch48qi0I.js";import"./switch-CQMIwMOV.js";import"./popover-CYbGzW0S.js";import"./chevron-left-AmoEll6X.js";import"./badge-DAUpYQro.js";import"./ellipsis-D87pnp6L.js";import"./pencil-DUvomj0i.js";import"./trash-2-CEPkq8Kd.js";const V=ie({code:ce().min(3,"Code must be at least 3 characters").max(50,"Code must be less than 50 characters"),type:le(["percentage","fixed"]),discount_value:p.number().min(0,"Discount value must be greater than 0").max(100,"Percentage discount cannot exceed 100%").nullable().default(null),min_order_amount:p.number().min(0,"Minimum order amount must be greater than 0").nullable(),max_discount_amount:p.number().min(0,"Maximum discount amount must be greater than 0").nullable(),usage_limit:p.number().int("Usage limit must be a whole number").min(1,"Usage limit must be at least 1").nullable(),valid_from:R().nullable(),valid_until:R().nullable(),is_active:re().default(!0),applicable_categories:P(E()).nullable(),applicable_services:P(E()).nullable()}),c={code:"",type:"percentage",discount_value:null,min_order_amount:null,max_discount_amount:null,usage_limit:null,valid_from:null,valid_until:null,is_active:!0,applicable_categories:null,applicable_services:null};function dt({coupons:r}){const[U,z]=o.useState([]),[k,B]=o.useState([]),[I,L]=o.useState({}),[pe,he]=o.useState(!1),[ge,xe]=o.useState(!1),[s,v]=o.useState(null),[H,y]=o.useState(!1),[q,S]=o.useState(!1),[G,d]=o.useState(!1),[J,K]=o.useState(!1),[Q,b]=o.useState(null),[m,i]=o.useState(!1),w=T({resolver:O(V),defaultValues:c}),u=T({resolver:O(V),defaultValues:c}),C=()=>{l.reload({only:["coupons"]})},W=async t=>{i(!0);try{l.post("/admin/coupons",t,{onSuccess:()=>{a.success("Coupon created successfully"),y(!1),w.reset(c),C()},onError:n=>{console.log(n),a.error(n.message||"Something went wrong")},onFinish:()=>{i(!1)}})}catch{a.error("Something went wrong"),i(!1)}},X=async t=>{i(!0);try{l.put(`/admin/coupons/${Q.id}`,t,{onSuccess:()=>{a.success("Coupon updated successfully"),S(!1),u.reset(c),b(null),C()},onError:n=>{console.log(n),a.error(n.message||"Something went wrong")},onFinish:()=>{i(!1)}})}catch{a.error("Something went wrong"),i(!1)}},D=t=>{b(t),u.reset({...t,valid_from:t.valid_from?new Date(t.valid_from):null,valid_until:t.valid_until?new Date(t.valid_until):null}),S(!0)},N=t=>{v(t),d(!0)},Y=async()=>{if(s){i(!0);try{await l.delete(`/admin/coupons/${s.id}`,{onSuccess:()=>{a.success("Coupon deleted successfully"),d(!1),v(null),l.visit(route("admin.coupons.index"),{preserveScroll:!0,preserveState:!1})},onError:t=>{console.error("Delete error:",t),a.error(t.message||"Failed to delete coupon")},onFinish:()=>{i(!1)},preserveScroll:!0})}catch(t){console.error("Delete error:",t),a.error("Failed to delete coupon"),i(!1)}}},F=async t=>{try{l.put(route("admin.coupons.toggle-status",t.id),{},{onSuccess:()=>{a.success("Coupon status updated successfully"),C()},onError:n=>{a.error(n.message||"Failed to update coupon status")}})}catch{a.error("Something went wrong")}};return ee({data:(r==null?void 0:r.data)??[],columns:$({handleEdit:D,handleToggleStatus:F,confirmDelete:N}),getCoreRowModel:ne(),getPaginationRowModel:ae(),getSortedRowModel:oe(),getFilteredRowModel:se(),onSortingChange:z,onColumnFiltersChange:B,onRowSelectionChange:L,initialState:{pagination:{pageSize:10}},state:{sorting:U,columnFilters:k,rowSelection:I}}),e.jsxs(me,{children:[e.jsx(Z,{title:"Coupons"}),e.jsxs("div",{className:"container mx-auto py-10 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Coupons"}),e.jsxs(h,{open:H,onOpenChange:t=>{t||w.reset(c),y(t)},children:[e.jsx(de,{asChild:!0,children:e.jsxs(_,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Add Coupon"]})}),e.jsxs(g,{children:[e.jsxs(x,{children:[e.jsx(f,{children:"Add New Coupon"}),e.jsx(j,{children:"Fill in the details to create a new coupon."})]}),e.jsx(M,{form:w,onSubmit:W,isSubmitting:m})]})]})]}),e.jsx(te,{columns:$({handleEdit:D,handleToggleStatus:F,confirmDelete:N}),data:(r==null?void 0:r.data)??[],defaultPageSize:10,pageSizeOptions:[10,20,30,40,50]}),e.jsx(h,{open:q,onOpenChange:t=>{t||(u.reset(c),b(null)),S(t)},children:e.jsxs(g,{children:[e.jsxs(x,{children:[e.jsx(f,{children:"Edit Coupon"}),e.jsx(j,{children:"Update the details of this coupon."})]}),e.jsx(M,{form:u,onSubmit:X,isSubmitting:m})]})}),e.jsx(h,{open:G,onOpenChange:d,children:e.jsxs(g,{className:"sm:max-w-md",children:[e.jsxs(x,{children:[e.jsx(f,{children:"Delete Coupon"}),e.jsxs(j,{children:['Are you sure you want to delete the coupon "',s==null?void 0:s.code,'"? This action cannot be undone.']})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(_,{variant:"outline",onClick:()=>{d(!1),v(null)},disabled:m,className:"flex-1",children:"Cancel"}),e.jsx(_,{variant:"destructive",onClick:Y,disabled:m,className:"flex-1",children:m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):"Delete"})]})]})}),e.jsx(h,{open:J,onOpenChange:K,children:e.jsxs(g,{children:[e.jsxs(x,{children:[e.jsx(f,{children:"Coupon Details"}),e.jsx(j,{children:"View the complete information about this coupon."})]}),s&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Code"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.code})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.type})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Discount Value"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.type==="percentage"?`${s.discount_value}%`:`$${s.discount_value}`})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Usage Count"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.usage_count," /"," ",s.usage_limit||"âˆž"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Valid Period"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.valid_from?A(new Date(s.valid_from),"PPP"):"Any time"," ","-"," ",s.valid_until?A(new Date(s.valid_until),"PPP"):"No expiry"]})]})]})})]})})]})]})}export{dt as default};
