import{r as E,j as e}from"./app-D5zgOKAD.js";import{u as I,F as $,a as c,b as d,c as l,d as m,e as u}from"./form-B0NGfjOj.js";import{s as B}from"./zod-CTB78kiI.js";import{o as N,e as Q,s as p,d as A,a as z,n as D}from"./index-DWbN24nP.js";import{t as H}from"./index-CDOhrpKr.js";import{P as r}from"./index-D8untdAM.js";import{B as S,c as L}from"./index-C8-8ZKTM.js";import{P as M,a as U,b as G,C as J}from"./popover-CYbGzW0S.js";import{I as g}from"./input-D5FKwQjB.js";import{S as q,a as P,b as T,c as F,d as h}from"./select-DgOef9zO.js";import{T as k}from"./textarea-rFmGb7jf.js";import{C as K,a as W}from"./card-BKGLJ8p-.js";import"./separator-ZBq7OQqG.js";import{C as X}from"./checkbox-Dba-AV0K.js";import{C as Y}from"./calendar-CP_I-VWs.js";import{f as Z}from"./format-SmSpYad1.js";import"./label-BHpa9F8K.js";import"./index-BBAzO_4d.js";import"./chevron-right-DKEmXFr0.js";import"./createLucideIcon-AWgR876W.js";import"./chevron-left-AmoEll6X.js";import"./index-BSVezLny.js";import"./Combination-Cmb1a147.js";import"./tslib.es6-CmEaCU22.js";import"./index-BB6OtDRK.js";import"./index-DNxp1Wi1.js";import"./index-Cuq-Mmvq.js";import"./index-Crc4BVh8.js";import"./index-BKYgjeKX.js";import"./index-CrEWOBzh.js";import"./chevron-down-CztE_ilu.js";import"./check-BhB20Pym.js";const ee=N({service_id:p().min(1,"Please select a service"),selected_options:z(N({option_id:p(),quantity:D().min(1).optional()})).default([]),booking_date:A({required_error:"Please select a date"}),customer_name:p().min(2,"Name must be at least 2 characters"),customer_email:p().email("Invalid email address"),customer_phone:p().min(10,"Phone number must be at least 10 digits"),customer_address:p().min(5,"Address must be at least 5 characters"),notes:p().optional(),status:Q(["pending","confirmed","completed","cancelled"]).default("pending")});function se({onSubmit:V,initialData:f=null,isSubmitting:y=!1,services:b=[],availableTimeSlots:te=[]}){const a=I({resolver:B(ee),defaultValues:f||{service_id:"",selected_options:[],booking_date:void 0,customer_name:"",customer_email:"",customer_phone:"",customer_address:"",notes:"",status:"pending"}}),v=a.watch("service_id"),_=a.watch("selected_options"),j=b.find(s=>s.id.toString()===v),x=(j==null?void 0:j.options)||[],C=(()=>{let s=0;return _.forEach(n=>{const i=x.find(t=>t.id.toString()===n.option_id);if(i){const t=parseFloat(i.price)||0;if(i.is_variable){const o=parseInt(n.quantity)||1;s+=t*o}else s+=t}}),s.toFixed(2)})();E.useEffect(()=>{a.setValue("selected_options",[])},[v]);const O=(s,n)=>{const i=a.getValues("selected_options"),t=x.find(o=>o.id.toString()===s);n?a.setValue("selected_options",[...i,{option_id:s,quantity:t!=null&&t.is_variable?1:void 0}]):a.setValue("selected_options",i.filter(o=>o.option_id!==s))},w=(s,n)=>{const t=a.getValues("selected_options").map(o=>o.option_id===s?{...o,quantity:Number(n)}:o);a.setValue("selected_options",t)},R=async s=>{try{if(console.log("Submitting form data:",s),s.selected_options.length===0){a.setError("selected_options",{type:"manual",message:"Please select at least one service option"});return}if(s.selected_options.some(i=>{const t=x.find(o=>o.id.toString()===i.option_id);if(t!=null&&t.is_variable){const o=i.quantity||1;if(t.min_qty&&o<t.min_qty)return a.setError("selected_options",{type:"manual",message:`Quantity for ${t.label} must be at least ${t.min_qty}`}),!0;if(t.max_qty&&o>t.max_qty)return a.setError("selected_options",{type:"manual",message:`Quantity for ${t.label} cannot exceed ${t.max_qty}`}),!0}return!1}))return;await V(s)}catch(n){console.error("Form submission error:",n),H.error("Failed to submit booking. Please try again.")}};return e.jsx($,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{control:a.control,name:"service_id",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Service"}),e.jsxs(q,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(P,{children:e.jsx(T,{placeholder:"Select a service"})})}),e.jsx(F,{children:b.map(n=>e.jsx(h,{value:n.id.toString(),children:n.name},n.id))})]}),e.jsx(u,{})]})}),j&&x.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Service Options"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2",children:x.map(s=>{const n=_.some(t=>t.option_id===s.id.toString()),i=_.find(t=>t.option_id===s.id.toString());return e.jsx("div",{className:"flex flex-col space-y-2 p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(X,{checked:n,onCheckedChange:t=>O(s.id.toString(),t)}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(l,{children:[s.label,s.is_variable?" (per unit)":""]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["£",Number(s.price).toFixed(2),s.note&&` - ${s.note}`]}),s.is_variable&&n&&e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{className:"text-sm",children:"Quantity"}),e.jsx(g,{type:"number",min:s.min_qty||1,max:s.max_qty,value:(i==null?void 0:i.quantity)||1,onChange:t=>w(s.id.toString(),t.target.value),className:"w-24"})]})]})]})},s.id)})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(K,{children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Price:"}),e.jsx("span",{className:"text-lg font-bold",children:C==="NaN"?"£0.00":`£${C}`})]})})})}),e.jsx(c,{control:a.control,name:"booking_date",render:({field:s})=>e.jsxs(d,{className:"flex flex-col",children:[e.jsx(l,{children:"Booking Date"}),e.jsxs(M,{children:[e.jsx(U,{asChild:!0,children:e.jsx(m,{children:e.jsxs(S,{variant:"outline",className:L("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?Z(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(Y,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(G,{className:"w-auto p-0",align:"start",children:e.jsx(J,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:n=>n<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),e.jsx(u,{})]})}),e.jsx(c,{control:a.control,name:"customer_name",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Customer Name"}),e.jsx(m,{children:e.jsx(g,{...s})}),e.jsx(u,{})]})}),e.jsx(c,{control:a.control,name:"customer_email",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Customer Email"}),e.jsx(m,{children:e.jsx(g,{type:"email",...s})}),e.jsx(u,{})]})}),e.jsx(c,{control:a.control,name:"customer_phone",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Customer Phone"}),e.jsx(m,{children:e.jsx(g,{type:"tel",...s})}),e.jsx(u,{})]})}),e.jsx(c,{control:a.control,name:"customer_address",render:({field:s})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(l,{children:"Customer Address"}),e.jsx(m,{children:e.jsx(k,{placeholder:"Enter customer's full address",className:"resize-none",...s})}),e.jsx(u,{})]})}),e.jsx(c,{control:a.control,name:"notes",render:({field:s})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(l,{children:"Notes"}),e.jsx(m,{children:e.jsx(k,{placeholder:"Any additional notes or requirements",className:"resize-none",...s})}),e.jsx(u,{})]})}),f&&e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Status"}),e.jsxs(q,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(P,{children:e.jsx(T,{placeholder:"Select status"})})}),e.jsxs(F,{children:[e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"confirmed",children:"Confirmed"}),e.jsx(h,{value:"completed",children:"Completed"}),e.jsx(h,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(u,{})]})})]}),e.jsx(S,{type:"submit",disabled:y,children:y?"Saving...":f?"Update Booking":"Create Booking"})]})})}se.propTypes={onSubmit:r.func.isRequired,initialData:r.object,isSubmitting:r.bool,services:r.arrayOf(r.shape({id:r.oneOfType([r.string,r.number]).isRequired,name:r.string.isRequired,category:r.shape({id:r.oneOfType([r.string,r.number]).isRequired,name:r.string.isRequired}),options:r.arrayOf(r.shape({id:r.oneOfType([r.string,r.number]).isRequired,label:r.string.isRequired,price:r.number.isRequired,min_qty:r.number,max_qty:r.number,is_variable:r.bool,note:r.string,is_active:r.bool}))})).isRequired,availableTimeSlots:r.arrayOf(r.string)};export{se as BookingForm};
